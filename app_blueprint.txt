# ğŸ›ï¸ HSE MANAGEMENT SYSTEM - ENTERPRISE BLUEPRINT

## Application Overview

| Property | Value |
|----------|-------|
| **Platform** | Web Application (SaaS) |
| **Framework** | Next.js 16.1.1 |
| **Language** | TypeScript |
| **Runtime** | React 19.2.3 |
| **Hosting** | Vercel (Edge-optimized) |
| **Database** | Supabase (PostgreSQL) |
| **Authentication** | Supabase Auth (Planned) |
| **PWA** | Yes - Installable on Mobile |

---

## ğŸ“ PROJECT STRUCTURE

```
hse-management-system-nextjs/
â”œâ”€â”€ app/                          # Next.js App Router (Pages)
â”‚   â”œâ”€â”€ api/                      # Backend API Routes
â”‚   â”‚   â”œâ”€â”€ ai-insight/           # OpenAI GPT-4o Integration
â”‚   â”‚   â”œâ”€â”€ calendar/             # Calendar Events API
â”‚   â”‚   â”œâ”€â”€ drive/                # Google Drive Integration
â”‚   â”‚   â”œâ”€â”€ programs/             # Program CRUD Operations
â”‚   â”‚   â”œâ”€â”€ seed-otp/             # Database Seeding
â”‚   â”‚   â””â”€â”€ stream-token/         # Stream Feeds Token Generator
â”‚   â”œâ”€â”€ audit-logs/               # Audit Trail Page
â”‚   â”œâ”€â”€ calendar/                 # Calendar View
â”‚   â”œâ”€â”€ community/                # Social Feed (Stream.io)
â”‚   â”œâ”€â”€ hse-kpi/                  # KPI Dashboard
â”‚   â”œâ”€â”€ hse-programs/             # HSE Programs Management
â”‚   â”œâ”€â”€ ll-indicator/             # Leading/Lagging Indicators
â”‚   â”œâ”€â”€ matrix/                   # Audit/Training/Drill Matrix
â”‚   â”œâ”€â”€ otp/                      # Objective Target Program
â”‚   â”œâ”€â”€ related-docs/             # Document Repository
â”‚   â”œâ”€â”€ settings/                 # User Settings
â”‚   â”œâ”€â”€ statistics/               # Analytics Dashboard
â”‚   â””â”€â”€ tasks/                    # Task Management
â”œâ”€â”€ components/                   # Reusable UI Components
â”‚   â”œâ”€â”€ charts/                   # Data Visualization
â”‚   â”œâ”€â”€ dashboard/                # Dashboard Widgets
â”‚   â”œâ”€â”€ feed/                     # Social Feed Components
â”‚   â”œâ”€â”€ layout/                   # App Shell, Sidebar
â”‚   â”œâ”€â”€ otp/                      # OTP-Specific Components
â”‚   â”œâ”€â”€ providers/                # Context Providers
â”‚   â”œâ”€â”€ reports/                  # PDF Report Generators
â”‚   â””â”€â”€ ui/                       # Core UI Kit (GlassCard, etc.)
â”œâ”€â”€ hooks/                        # Custom React Hooks
â”‚   â”œâ”€â”€ useAuditLogs.ts           # Audit Log Queries
â”‚   â”œâ”€â”€ useHSEPrograms.ts         # Program CRUD + Realtime
â”‚   â””â”€â”€ useKPI.ts                 # KPI Mutations
â”œâ”€â”€ lib/                          # Business Logic & Utilities
â”‚   â”œâ”€â”€ actions/                  # Server Actions (Supabase)
â”‚   â”œâ”€â”€ email/                    # Email Integration (SES, Brevo)
â”‚   â”œâ”€â”€ supabase/                 # Supabase Client Config
â”‚   â””â”€â”€ *-store.ts                # Data Stores
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/               # Database Schema SQL
â”œâ”€â”€ types/                        # TypeScript Types
â”œâ”€â”€ public/                       # Static Assets
â”‚   â””â”€â”€ manifest.json             # PWA Configuration
â””â”€â”€ .github/workflows/            # CI/CD Automation
```

---

## ğŸ¨ FRONTEND ARCHITECTURE

### Pages (13 Total)

| Route | Page | Description |
|-------|------|-------------|
| `/` | Home | Dashboard with metrics, AI Consultant, charts |
| `/otp` | OTP | Objective Target Program tracking |
| `/matrix` | Matrix | Audit, Training, Drill, Meeting matrices |
| `/hse-programs` | Programs | Full program management |
| `/hse-kpi` | KPI | Key Performance Indicators |
| `/ll-indicator` | LL Indicator | Leading/Lagging Indicator trends |
| `/tasks` | Tasks | Task management with priorities |
| `/calendar` | Calendar | Unified calendar from OTP + Tasks |
| `/statistics` | Statistics | Data analytics dashboard |
| `/related-docs` | Documents | File storage with Google Drive |
| `/community` | Community | Social feed (Stream.io) |
| `/settings` | Settings | Theme, language, branding |
| `/audit-logs` | Audit Logs | System activity tracking |

### Component Library

| Component | Location | Description |
|-----------|----------|-------------|
| `AppShell` | `components/layout/` | Responsive sidebar, mobile nav, drawer |
| `GlassCard` | `components/ui/` | Glassmorphism card with blur |
| `PageTransition` | `components/ui/` | Framer Motion page animations |
| `LottieDisplay` | `components/ui/` | Loading/success/empty animations |
| `AIConsultant` | `components/dashboard/` | AI-powered insights panel |
| `RightSidebar` | `components/dashboard/` | Safety moments gallery |
| `MobileProgramCard` | `components/otp/` | Mobile-optimized cards |
| `PDFDownloadButton` | `components/otp/` | PDF report generation |

---

## âš™ï¸ BACKEND ARCHITECTURE

### API Routes (6 Endpoints)

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/ai-insight` | POST | AI analysis of dashboard data (GPT-4o-mini) |
| `/api/calendar` | GET | Fetch calendar events from Supabase |
| `/api/drive/*` | ALL | Google Drive file operations |
| `/api/programs` | ALL | Program CRUD with Supabase |
| `/api/seed-otp` | POST | Seed OTP data to database |
| `/api/stream-token` | GET | Generate Stream Feeds user token |

### Server Actions (Supabase)

| Action | File | Description |
|--------|------|-------------|
| `getKPIYear()` | `lib/actions/kpi-actions.ts` | Fetch/create KPI year data |
| `updateManHours()` | `lib/actions/kpi-actions.ts` | Update man hours |
| `saveMetric()` | `lib/actions/kpi-actions.ts` | Create/update KPI metric |
| `deleteMetric()` | `lib/actions/kpi-actions.ts` | Delete KPI metric |

---

## ğŸ—„ï¸ DATABASE SCHEMA (Supabase)

### Tables

| Table | Purpose | Key Columns |
|-------|---------|-------------|
| `master_programs` | Program definitions | id, name, program_type, region, base, plan_type |
| `program_progress` | Monthly progress | program_id, month, year, plan_value, actual_value, status |
| `hse_kpi_years` | KPI year records | id, year, man_hours |
| `hse_kpi_metrics` | KPI metrics | year_id, name, target, result, icon |

### Row Level Security (RLS)
- All tables have RLS enabled
- Public read/write policies (auth to be implemented)

---

## ğŸ“¦ DEPENDENCIES

### Core Framework
| Package | Version | Purpose |
|---------|---------|---------|
| `next` | 16.1.1 | React Framework |
| `react` | 19.2.3 | UI Library |
| `typescript` | ^5 | Type Safety |

### Database & Backend
| Package | Version | Purpose |
|---------|---------|---------|
| `@supabase/supabase-js` | ^2.89.0 | Database Client |
| `@supabase/ssr` | ^0.8.0 | Server-Side Rendering |
| `@tanstack/react-query` | ^5.90.16 | Data Fetching & Caching |

### UI & Visualization
| Package | Version | Purpose |
|---------|---------|---------|
| `@tremor/react` | ^3.18.7 | Dashboard Charts |
| `framer-motion` | ^12.23.26 | Animations |
| `lucide-react` | ^0.562.0 | Icons |
| `recharts` | ^3.6.0 | Charts |
| `react-lottie-player` | ^2.1.0 | Lottie Animations |
| `tailwindcss` | ^4 | Styling |
| `clsx` | ^2.1.1 | Class Utilities |

### AI & Integrations
| Package | Version | Purpose |
|---------|---------|---------|
| `openai` | ^6.15.0 | GPT-4o AI Analysis |
| `getstream` | ^8.8.0 | Social Feed Backend |
| `react-activity-feed` | ^1.4.0 | Social Feed UI |
| `googleapis` | ^169.0.0 | Google Drive API |

### Email & Notifications
| Package | Version | Purpose |
|---------|---------|---------|
| `@aws-sdk/client-ses` | ^3.958.0 | AWS SES Email |
| `sonner` | ^2.0.7 | Toast Notifications |

### Export & Reports
| Package | Version | Purpose |
|---------|---------|---------|
| `@react-pdf/renderer` | ^4.3.2 | PDF Generation |
| `xlsx` | ^0.18.5 | Excel Export |

---

## ğŸ”§ KEY FEATURES

### 1. OTP (Objective Target Program)
- Multi-region support (Indonesia, Asia)
- Multi-base filtering (Duri, Narogong, Balikpapan)
- Monthly plan vs actual tracking
- Progress visualization
- CSV/PDF export
- Email reminders

### 2. HSE Matrix
- 4 categories: Audit, Training, Drill, Meeting
- Regional breakdown
- Program assignment tracking

### 3. KPI Dashboard
- Man hours tracking
- Custom metric creation
- Target vs Result comparison
- Tremor charts visualization

### 4. Leading/Lagging Indicators
- 12 indicator types
- Trend analysis
- Year-over-year comparison

### 5. AI Consultant
- GPT-4o-mini integration
- Executive summary generation
- Risk identification
- Action recommendations
- Health score calculation

### 6. Social Community Feed
- Stream.io integration
- Activity posting
- Real-time updates
- Trending topics

### 7. Document Management
- Google Drive integration
- File upload/download
- Category organization

### 8. Email System
- AWS SES integration
- Brevo fallback
- OTP reminder templates
- HTML email generation

### 9. PWA Support
- Installable on mobile
- Offline-ready manifest
- Touch-optimized UI

### 10. Responsive Design
- Desktop sidebar (250px)
- Tablet collapsed sidebar (70px)
- Mobile bottom nav + drawer
- Safe area insets (iPhone)

---

## ğŸ” ENVIRONMENT VARIABLES

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=

# OpenAI
OPENAI_API_KEY=

# Stream Feeds
NEXT_PUBLIC_STREAM_APP_KEY=
NEXT_PUBLIC_STREAM_APP_ID=
STREAM_APP_SECRET=

# AWS SES
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=
SES_FROM_EMAIL=

# Brevo (Fallback Email)
BREVO_API_KEY=
BREVO_FROM_EMAIL=
BREVO_FROM_NAME=

# App Config
NEXT_PUBLIC_APP_URL=
EMAIL_PROVIDER=ses|brevo|smtp
```

---

## ğŸš€ CI/CD PIPELINE

### GitHub Actions Workflow
```yaml
Triggers: push to main, pull_request
Jobs:
  - lint: ESLint check
  - build: Next.js production build
  - upload: Artifact storage
  - notify: Failure notifications
```

---

## ğŸ“Š DATA FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚â”€â”€â”€â”€â–¶â”‚   Next.js   â”‚â”€â”€â”€â”€â–¶â”‚  Supabase   â”‚
â”‚  (React)    â”‚â—€â”€â”€â”€â”€â”‚  API Routes â”‚â—€â”€â”€â”€â”€â”‚ PostgreSQL  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”           â”‚
       â”‚           â”‚               â”‚           â”‚
       â–¼           â–¼               â–¼           â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚ OpenAI  â”‚ â”‚ Stream  â”‚   â”‚ Google  â”‚       â”‚
  â”‚ GPT-4o  â”‚ â”‚  Feeds  â”‚   â”‚ Drive   â”‚       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚           â”‚               â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Real-time Subscriptions
```

---

## ğŸ¯ USE CASES

1. **HSE Manager** - Track program progress, set targets
2. **Site Supervisor** - Update actual values, report incidents  
3. **Executive** - View AI insights, KPI dashboards
4. **Compliance Officer** - Audit trail, document management
5. **Team Member** - Community updates, task assignments

---

## ğŸ“± DEPLOYMENT

| Environment | Platform | URL |
|-------------|----------|-----|
| Production | Vercel | hseplanv-2.vercel.app |
| Database | Supabase | *.supabase.co |
| Files | Google Drive | drive.google.com |
| Email | AWS SES | us-east-1 |

---

## ğŸ† ENTERPRISE CAPABILITIES

- âœ… Multi-tenant architecture ready
- âœ… Role-based access control (RLS)
- âœ… Real-time data synchronization
- âœ… AI-powered analytics
- âœ… Audit trail logging
- âœ… PDF/Excel export
- âœ… Email automation
- âœ… PWA mobile support
- âœ… CI/CD automation
- âœ… Type-safe codebase

---

**Version:** 0.1.0  
**Last Updated:** 2026-01-01  
**License:** Enterprise SaaS
